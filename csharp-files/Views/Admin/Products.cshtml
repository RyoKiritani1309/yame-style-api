@model YameApi.Models.DTOs.ProductListResponse
@{
    ViewData["Title"] = "Quản lý sản phẩm";
}

<div class="admin-products">
    <div class="page-header">
        <h1>Quản lý sản phẩm</h1>
        <a href="@Url.Action("CreateProduct", "Admin")" class="btn-primary">+ Thêm sản phẩm mới</a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-error">@TempData["Error"]</div>
    }

    <div class="products-table">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Hình ảnh</th>
                    <th>Tên sản phẩm</th>
                    <th>Giá</th>
                    <th>Danh mục</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in Model.Products)
                {
                    <tr>
                        <td>@product.Id</td>
                        <td>
                            @if (product.Images?.Any() == true)
                            {
                                <img src="@product.Images.First()" alt="@product.Title" class="product-thumb">
                            }
                        </td>
                        <td>
                            <strong>@product.Title</strong><br>
                            <small>@product.Slug</small>
                        </td>
                        <td>
                            @if (product.SalePrice.HasValue)
                            {
                                <span class="sale-price">@product.SalePrice.Value.ToString("N0") ₫</span><br>
                                <span class="original-price">@product.Price.ToString("N0") ₫</span>
                            }
                            else
                            {
                                <span>@product.Price.ToString("N0") ₫</span>
                            }
                        </td>
                        <td>@product.PrimaryCategory</td>
                        <td>
                            @if (product.Availability)
                            {
                                <span class="badge badge-success">Còn hàng</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Hết hàng</span>
                            }
                        </td>
                        <td class="actions">
                            <a href="@Url.Action("EditProduct", "Admin", new { id = product.Id })" class="btn-edit">Sửa</a>
                            <button onclick="deleteProduct(@product.Id)" class="btn-delete">Xóa</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (Model.TotalPages > 1)
    {
        <div class="pagination">
            @if (Model.CurrentPage > 1)
            {
                <a href="?page=@(Model.CurrentPage - 1)">« Trước</a>
            }
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                if (i == Model.CurrentPage)
                {
                    <span class="active">@i</span>
                }
                else
                {
                    <a href="?page=@i">@i</a>
                }
            }
            @if (Model.CurrentPage < Model.TotalPages)
            {
                <a href="?page=@(Model.CurrentPage + 1)">Sau »</a>
            }
        </div>
    }
</div>

<script>
function deleteProduct(id) {
    if (!confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) return;
    
    fetch('/Admin/DeleteProduct', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: id })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Không thể xóa sản phẩm: ' + data.message);
        }
    });
}
</script>

<style>
.admin-products {
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px 20px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #1a1a1a;
}

.btn-primary {
    background: #1a1a1a;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background: #333;
}

.alert {
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.products-table {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    background: #f8f9fa;
}

th {
    padding: 16px;
    text-align: left;
    font-weight: 600;
    color: #1a1a1a;
    border-bottom: 2px solid #e5e5e5;
}

td {
    padding: 16px;
    border-bottom: 1px solid #e5e5e5;
}

.product-thumb {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
}

.sale-price {
    color: #ff6b6b;
    font-weight: 600;
}

.original-price {
    text-decoration: line-through;
    color: #999;
    font-size: 14px;
}

.badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.badge-success {
    background: #d4edda;
    color: #155724;
}

.badge-danger {
    background: #f8d7da;
    color: #721c24;
}

.actions {
    display: flex;
    gap: 8px;
}

.btn-edit, .btn-delete {
    padding: 6px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-edit {
    background: #e3f2fd;
    color: #1976d2;
}

.btn-edit:hover {
    background: #bbdefb;
}

.btn-delete {
    background: #ffebee;
    color: #c62828;
}

.btn-delete:hover {
    background: #ffcdd2;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 30px;
}

.pagination a, .pagination span {
    padding: 8px 16px;
    border: 1px solid #e5e5e5;
    border-radius: 6px;
    text-decoration: none;
    color: #1a1a1a;
    transition: all 0.3s ease;
}

.pagination a:hover {
    background: #f8f9fa;
}

.pagination span.active {
    background: #1a1a1a;
    color: white;
    border-color: #1a1a1a;
}
</style>
