@model YameApi.Models.Order
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
}

<div class="admin-order-detail">
    <div class="page-header">
        <h1>Chi tiết đơn hàng #@Model.OrderNumber</h1>
        <a href="@Url.Action("Orders", "Admin")" class="btn-back">← Quay lại</a>
    </div>

    <div class="order-info-grid">
        <div class="info-card">
            <h3>Thông tin đơn hàng</h3>
            <div class="info-row">
                <span class="label">Mã đơn:</span>
                <span class="value">@Model.OrderNumber</span>
            </div>
            <div class="info-row">
                <span class="label">Ngày đặt:</span>
                <span class="value">@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</span>
            </div>
            <div class="info-row">
                <span class="label">Trạng thái:</span>
                <span class="value">
                    <select class="status-select" data-order-id="@Model.OrderId" onchange="updateStatus(this)">
                        <option value="Pending" @(Model.Status == "Pending" ? "selected" : "")>Chờ xử lý</option>
                        <option value="Processing" @(Model.Status == "Processing" ? "selected" : "")>Đang xử lý</option>
                        <option value="Shipped" @(Model.Status == "Shipped" ? "selected" : "")>Đã gửi</option>
                        <option value="Delivered" @(Model.Status == "Delivered" ? "selected" : "")>Đã giao</option>
                        <option value="Cancelled" @(Model.Status == "Cancelled" ? "selected" : "")>Đã hủy</option>
                    </select>
                </span>
            </div>
            <div class="info-row">
                <span class="label">Thanh toán:</span>
                <span class="value">@Model.PaymentMethod</span>
            </div>
            <div class="info-row">
                <span class="label">Vận chuyển:</span>
                <span class="value">@Model.ShippingMethod</span>
            </div>
        </div>

        <div class="info-card">
            <h3>Thông tin giao hàng</h3>
            <p>@Model.ShippingAddress</p>
        </div>
    </div>

    <div class="order-items">
        <h3>Sản phẩm</h3>
        <table>
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th>Biến thể</th>
                    <th>Đơn giá</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Items)
                {
                    <tr>
                        <td>
                            <strong>@item.Product?.Title</strong>
                        </td>
                        <td>
                            @if (item.Variant != null)
                            {
                                <span>@item.Variant.Size - @item.Variant.Color</span>
                            }
                        </td>
                        <td>@item.UnitPrice.ToString("N0") ₫</td>
                        <td>@item.Quantity</td>
                        <td>@item.LineTotal.ToString("N0") ₫</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="order-summary">
        <div class="summary-row">
            <span>Tạm tính:</span>
            <span>@Model.SubTotal.ToString("N0") ₫</span>
        </div>
        <div class="summary-row">
            <span>Giảm giá:</span>
            <span>-@Model.Discount.ToString("N0") ₫</span>
        </div>
        <div class="summary-row">
            <span>Phí vận chuyển:</span>
            <span>@Model.Shipping.ToString("N0") ₫</span>
        </div>
        <div class="summary-row">
            <span>Thuế:</span>
            <span>@Model.Tax.ToString("N0") ₫</span>
        </div>
        <div class="summary-row total">
            <span>Tổng cộng:</span>
            <span>@Model.Total.ToString("N0") ₫</span>
        </div>
    </div>
</div>

<script>
function updateStatus(select) {
    const orderId = select.dataset.orderId;
    const status = select.value;
    
    fetch('/Admin/UpdateOrderStatus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ orderId: orderId, status: status })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('Cập nhật trạng thái thành công');
        } else {
            alert('Không thể cập nhật: ' + data.message);
        }
    });
}
</script>

<style>
.admin-order-detail {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 20px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #1a1a1a;
}

.btn-back {
    padding: 10px 20px;
    background: #f5f5f5;
    color: #1a1a1a;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-back:hover {
    background: #e5e5e5;
}

.order-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.info-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.info-card h3 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #f5f5f5;
}

.info-row:last-child {
    border-bottom: none;
}

.label {
    color: #666;
    font-weight: 600;
}

.value {
    color: #1a1a1a;
}

.status-select {
    padding: 6px 12px;
    border: 1px solid #e5e5e5;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
}

.order-items {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}

.order-items h3 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    text-align: left;
    padding: 12px;
    background: #f8f9fa;
    font-weight: 600;
    color: #1a1a1a;
    border-bottom: 2px solid #e5e5e5;
}

td {
    padding: 12px;
    border-bottom: 1px solid #f5f5f5;
}

.order-summary {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    max-width: 400px;
    margin-left: auto;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #f5f5f5;
}

.summary-row.total {
    border-top: 2px solid #e5e5e5;
    border-bottom: none;
    padding-top: 16px;
    margin-top: 8px;
    font-weight: 700;
    font-size: 18px;
    color: #1a1a1a;
}
</style>
