@model YameApi.Models.Product
@{
    ViewData["Title"] = Model.Title + " - YAME";
    var hasDiscount = Model.SalePrice.HasValue && Model.SalePrice < Model.Price;
    var discountPercent = hasDiscount ? Math.Round(((Model.Price - Model.SalePrice!.Value) / Model.Price) * 100) : 0;
}

@{
    Layout = "_Layout";
}

<div class="product-detail-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-nav">
            <a href="/" class="breadcrumb-link">Trang chủ</a>
            <span class="breadcrumb-separator">/</span>
            <a href="/Products" class="breadcrumb-link">Sản phẩm</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">@Model.Title</span>
        </nav>

        <div class="product-detail-grid">
            <!-- Product Images -->
            <div class="product-images">
                <div class="main-image">
                    <img src="@Model.Images.FirstOrDefault()" alt="@Model.Title" class="product-main-img">
                </div>
                @if (Model.Images.Count > 1)
                {
                    <div class="image-thumbnails">
                        @foreach (var image in Model.Images.Take(4))
                        {
                            <img src="@image" alt="@Model.Title" class="thumbnail-img">
                        }
                    </div>
                }
            </div>

            <!-- Product Info -->
            <div class="product-info">
                <h1 class="product-title">@Model.Title</h1>
                
                <div class="product-tags">
                    @foreach (var tag in Model.Tags)
                    {
                        <span class="product-tag">@tag</span>
                    }
                </div>

                <!-- Reviews -->
                @if (Model.Reviews != null)
                {
                    <div class="product-rating">
                        <div class="stars">
                            @for (int i = 0; i < 5; i++)
                            {
                                <span class="star @(i < Math.Floor(Model.Reviews.Average) ? "filled" : "")">★</span>
                            }
                        </div>
                        <span class="rating-text">@Model.Reviews.Average.ToString("0.0") (@Model.Reviews.Count đánh giá)</span>
                    </div>
                }

                <div class="product-price">
                    <span class="current-price">@((Model.SalePrice ?? Model.Price).ToString("N0"))đ</span>
                    @if (hasDiscount)
                    {
                        <span class="original-price">@Model.Price.ToString("N0")đ</span>
                        <span class="discount-badge">-@discountPercent%</span>
                    }
                </div>

                <p class="product-description">@Model.Description</p>

                <!-- Variants Selection -->
                <div class="variant-section">
                    <h3 class="section-title">Chọn kích cỡ</h3>
                    <div class="size-options">
                        @foreach (var variant in Model.Variants)
                        {
                            <label class="size-option">
                                <input type="radio" name="size" value="@variant.VariantId">
                                <span class="size-label">@variant.Size</span>
                            </label>
                        }
                    </div>
                </div>

                <div class="variant-section">
                    <h3 class="section-title">Số lượng</h3>
                    <div class="quantity-selector">
                        <button type="button" class="qty-btn" onclick="changeQuantity(-1)">−</button>
                        <input type="number" id="quantity" value="1" min="1" class="qty-input" readonly>
                        <button type="button" class="qty-btn" onclick="changeQuantity(1)">+</button>
                    </div>
                </div>

                <button class="add-to-cart-btn">Thêm vào giỏ hàng</button>

                <!-- Specifications -->
                @if (Model.Specs != null)
                {
                    <div class="specs-section">
                        <h3 class="section-title">Thông số kỹ thuật</h3>
                        <div class="specs-table">
                            @if (!string.IsNullOrEmpty(Model.Specs.Material))
                            {
                                <div class="spec-row">
                                    <span class="spec-label">Chất liệu:</span>
                                    <span class="spec-value">@Model.Specs.Material</span>
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(Model.Specs.MadeIn))
                            {
                                <div class="spec-row">
                                    <span class="spec-label">Xuất xứ:</span>
                                    <span class="spec-value">@Model.Specs.MadeIn</span>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
.product-detail-page {
    padding: 40px 0;
    min-height: 70vh;
}

.breadcrumb-nav {
    margin-bottom: 30px;
    font-size: 14px;
}

.breadcrumb-link {
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.3s;
}

.breadcrumb-link:hover {
    color: var(--primary);
}

.breadcrumb-separator {
    margin: 0 8px;
    color: var(--text-muted);
}

.breadcrumb-current {
    color: var(--text-primary);
}

.product-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    margin-bottom: 60px;
}

.product-images {
    position: sticky;
    top: 100px;
    height: fit-content;
}

.main-image {
    border-radius: 12px;
    overflow: hidden;
    background: var(--surface);
    margin-bottom: 20px;
}

.product-main-img {
    width: 100%;
    height: auto;
    display: block;
}

.image-thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.thumbnail-img {
    width: 100%;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.thumbnail-img:hover {
    border-color: var(--primary);
}

.product-info {
    padding: 20px 0;
}

.product-title {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 16px;
}

.product-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
}

.product-tag {
    padding: 6px 12px;
    background: var(--surface);
    color: var(--text-secondary);
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
}

.stars {
    display: flex;
    gap: 2px;
}

.star {
    color: #ddd;
    font-size: 20px;
}

.star.filled {
    color: #fbbf24;
}

.rating-text {
    color: var(--text-muted);
    font-size: 14px;
}

.product-price {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    padding: 20px 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
}

.current-price {
    font-size: 32px;
    font-weight: 700;
    color: var(--primary);
}

.original-price {
    font-size: 20px;
    color: var(--text-muted);
    text-decoration: line-through;
}

.discount-badge {
    padding: 6px 12px;
    background: #ef4444;
    color: white;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
}

.product-description {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 32px;
}

.variant-section {
    margin-bottom: 28px;
}

.section-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 12px;
}

.size-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.size-option {
    position: relative;
    cursor: pointer;
}

.size-option input {
    position: absolute;
    opacity: 0;
}

.size-label {
    display: block;
    padding: 10px 20px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s;
}

.size-option input:checked + .size-label {
    border-color: var(--primary);
    background: var(--primary-light);
    color: var(--primary);
}

.size-option:hover .size-label {
    border-color: var(--primary);
}

.quantity-selector {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    border: 2px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.qty-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: var(--surface);
    color: var(--text-primary);
    font-size: 20px;
    cursor: pointer;
    transition: background 0.3s;
}

.qty-btn:hover {
    background: var(--border);
}

.qty-input {
    width: 60px;
    height: 40px;
    border: none;
    text-align: center;
    font-weight: 600;
    background: transparent;
}

.add-to-cart-btn {
    width: 100%;
    padding: 16px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 32px;
}

.add-to-cart-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.specs-section {
    margin-top: 32px;
    padding-top: 32px;
    border-top: 1px solid var(--border);
}

.specs-table {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.spec-row {
    display: flex;
    padding: 12px 0;
}

.spec-label {
    width: 150px;
    font-weight: 600;
    color: var(--text-primary);
}

.spec-value {
    flex: 1;
    color: var(--text-secondary);
}

@@media (max-width: 768px) {
    .product-detail-grid {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .product-images {
        position: relative;
        top: 0;
    }
    
    .product-title {
        font-size: 24px;
    }
    
    .current-price {
        font-size: 24px;
    }
}
</style>

<script>
function changeQuantity(delta) {
    const input = document.getElementById('quantity');
    const currentValue = parseInt(input.value) || 1;
    const newValue = Math.max(1, currentValue + delta);
    input.value = newValue;
}

// Thumbnail image switching
document.addEventListener('DOMContentLoaded', function() {
    const thumbnails = document.querySelectorAll('.thumbnail-img');
    const mainImage = document.querySelector('.product-main-img');
    
    thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
            mainImage.src = this.src;
        });
    });
});
</script>
